## üìù Task Description (English)

### Overview

This task is divided into **three subtasks**, where each subsequent subtask includes all previous ones.
Code review will be performed on the most complete subtask submitted:

* If you submit the first and second subtasks, we will review the second and accept both.
* If you submit only the third subtask, we will review it and accept all subtasks at once.

---

### Task

You need to write a **parser for mathematical expressions** containing **random variables**.

You should download the **RandomVariable** project and implement `RandomVariableStatisticCalculator`.
Its **only method** receives:

1. a string describing a random variable, and
2. a set of statistics to compute.

---

### Expression Format

The string is a valid mathematical expression consisting of:

* **Unary operators:** `+` or `-`
* **Binary operators:** `+`, `-`, `*`, `/`
* **Parentheses** for grouping
* **Operands:** numbers or random variables

Numbers can be integers (`2`) or decimals (`1.5`).
All numbers should be treated as doubles ‚Äî e.g., the expression `3/2` should yield `1.5`, not `1`.

Random variables use **standard D&D notation**: `XdY` (e.g., `1d20`, `2d6`, `1d3`)

* **X** and **Y** are positive integers
* `XdY` means: ‚Äúroll X dice with Y sides each and sum the results‚Äù

**Restrictions:**

* X and Y cannot be decimals, expressions, or random variables ‚Äî only integers 1‚Äì100
* Between two random variables, only addition and subtraction are allowed

**Valid examples:**

```
5 * (1d20 + 4) / 7 + 1d6
```

**Invalid examples:**

```
1d20 * 2d6
1d3 / (4 + 2d20)
```

---

### Requirements

#### 1. Decomposition

* Code must be logically divided into **classes and methods**
* Solutions without decomposition will **not pass review**
* You may package your project using the familiar `csharp-packer` in `UserCode.cs`
* Only the contents of `UserCode.cs` should be submitted

#### 2. Efficiency

* Code must be **asymptotically efficient**
* Replacing LINQ with `foreach` is fine, but the goal is to **replace exponential algorithms with polynomial ones**

#### 3. Correctness

* Code must work correctly not only on the provided tests, but also on unseen cases

---

### Subtasks

#### **Subtask 1 ‚Äî Expected Value**

* Compute only the **expected value** of a discrete random variable
* Must be **O(n)** complexity

| Input                   | Expected Value    |
| ----------------------- | ----------------- |
| `2+2*2`                 | 6                 |
| `1d20`                  | 10.5              |
| `2d6+(-1d12/5)`         | 5.7               |
| `(1d12+2d6)/2`          | 6.75              |
| `3/2.1+100d100-4d8+1d4` | 5035.928571428572 |

---

#### **Subtask 2 ‚Äî Variance**

* In addition to the expected value, compute **variance**
* Algorithm must still be **O(n)**

| Input                   | Expected Value    | Variance |
| ----------------------- | ----------------- | -------- |
| `2+2*2`                 | 6                 | 0        |
| `1d20`                  | 10.5              | 33.25    |
| `2d6+(-1d12/5)`         | 5.7               | 6.31     |
| `(1d12+2d6)/2`          | 6.75              | 4.4375   |
| `3/2.1+100d100-4d8+1d4` | 5035.928571428572 | 83347.25 |

---

#### **Subtask 3 ‚Äî Probability Mass Function (PMF)**

* In addition to expected value and variance, compute the **probability mass function** (PMF) `f`
* Computing the PMF is algorithmically more complex; no strict complexity requirement is imposed
* However, code should still **efficiently compute expected value and variance in O(n)**

---

### üí° Notes

* Expressions are composed of numbers and random variables in **D&D notation**
* Only addition and subtraction are allowed between random variables
* Make sure all numeric calculations are **double-precision**
* Structure your code with clear **decomposition**, efficiency, and correctness in mind

---

–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º:

–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ —ç—Ç–∞ –∑–∞–¥–∞—á–∞?
    
–û–Ω–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ —Ç—Ä–∏ –ø–æ–¥–∑–∞–¥–∞—á–∏, –∫–∞–∂–¥–∞—è –ø–æ—Å–ª–µ–¥—É—é—â–∞—è –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –ø—Ä–µ–¥—ã–¥—É—â–∏–µ. –ü–æ—ç—Ç–æ–º—É code-review –±—É–¥–µ–º –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Å–∞–º–æ–π –ø–æ–ª–Ω–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏ (—Å–¥–∞—à—å –ø–µ—Ä–≤—É—é –∏ –≤—Ç–æ—Ä—É—é ‚Äî –ø—Ä–æ–≤–µ—Ä–∏–º –≤—Ç–æ—Ä—É—é –∏ –∑–∞—Å—á–∏—Ç–∞–µ–º –æ–±–µ; —Å–¥–∞—à—å —Ç–æ–ª—å–∫–æ —Ç—Ä–µ—Ç—å—é ‚Äî –ø—Ä–æ–≤–µ—Ä–∏–º –µ–µ –∏ –∑–∞—Å—á–∏—Ç–∞–µ–º —Å—Ä–∞–∑—É –≤—Å–µ).

–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞
    
–ù—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Å–ª—É—á–∞–π–Ω—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã.

–ù—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –ø—Ä–æ–µ–∫—Ç RandomVariable –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RandomVariableStatisticCalculator. –ï–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, –æ–ø–∏—Å—ã–≤–∞—é—â—É—é —Å–ª—É—á–∞–π–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É, –∏ –Ω–∞–±–æ—Ä –≤–∏–¥–æ–≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å.

–°—Ç—Ä–æ–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, —Å–æ—Å—Ç–æ—è—â–∏–µ –∏–∑ —É–Ω–∞—Ä–Ω—ã—Ö (+-) –∏ –±–∏–Ω–∞—Ä–Ω—ã—Ö (+-*/) –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, —Å–∫–æ–±–æ–∫ –∏ –æ–ø–µ—Ä–∞–Ω–¥–æ–≤ ‚Äî —á–∏—Å–µ–ª –∏ —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω. –ß–∏—Å–ª–∞ –º–æ–≥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ –≤ —Ü–µ–ª–æ–π —Ñ–æ—Ä–º–µ (2), —Ç–∞–∫ –∏ –≤ –≤–∏–¥–µ –¥–µ—Å—è—Ç–∏—á–Ω–æ–π –¥—Ä–æ–±–∏ (1.5). –°—Ç–æ–∏—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ª—é–±–æ–µ —á–∏—Å–ª–æ –∫–∞–∫ –¥—Ä–æ–±–Ω–æ–µ (double), —Ç.–µ. –≤—ã—Ä–∞–∂–µ–Ω–∏–µ 3/2 –¥–æ–ª–∂–Ω–æ –¥–∞–≤–∞—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ 1.5, –∞ –Ω–µ 1.

–°–ª—É—á–∞–π–Ω—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π D&D –Ω–æ—Ç–∞—Ü–∏–∏: XdY (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1d20, 2d6, 1d3), –≥–¥–µ X –∏ Y ‚Äî —Ü–µ–ª—ã–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞. XdY —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–∑–Ω–∞—á–∞–µ—Ç "–≤–∑—è—Ç—å X Y-–≥—Ä–∞–Ω–Ω—ã—Ö –∫–æ—Å—Ç–µ–π, –±—Ä–æ—Å–∏—Ç—å –∏—Ö –∏ –≤–∑—è—Ç—å —Å—É–º–º—É".

–£—Ç–æ—á–Ω–∏–º, —á—Ç–æ X –∏ Y –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥—Ä–æ–±–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏, –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –≤–µ–ª–∏—á–∏–Ω–∞–º–∏; —Ç–æ–ª—å–∫–æ —Ü–µ–ª—ã–º–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏ –æ—Ç 1 –¥–æ 100. –¢–∞–∫–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º, —á—Ç–æ –º–µ–∂–¥—É –¥–≤—É–º—è —Å–ª—É—á–∞–π–Ω—ã–º–∏ –≤–µ–ª–∏—á–∏–Ω–∞–º–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ —Å–ª–æ–∂–µ–Ω–∏—è –∏ –≤—ã—á–∏—Ç–∞–Ω–∏—è.

–¢.–µ. –≤—ã—Ä–∞–∂–µ–Ω–∏–µ 5 * (1d20 + 4) / 7 + 1d6 ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–æ, –∞ 1d20 * 2d6 –∏–ª–∏ 1d3 / (4 + 2d20) ‚Äî –Ω–µ—Ç.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è
2. –ö–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ª–æ–≥–∏—á–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ –∫–ª–∞—Å—Å–∞–º –∏ –º–µ—Ç–æ–¥–∞–º. –û–±—Ä–∞—Ç–∏—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Ä–µ—à–µ–Ω–∏—è –±–µ–∑ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –ø—Ä–æ–π–¥—É—Ç —Ä–µ–≤—å—é. –¢–∞–∫ —á—Ç–æ —Å–º–µ–ª–æ —Å—Ç—Ä–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –ø–∞–∫—É–π –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç —É–∂–µ –∑–Ω–∞–∫–æ–º—ã–º csharp-packer –≤ UserCode.cs: –∏–º–µ–Ω–Ω–æ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É.
3. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
4. –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞—Å–∏–º–ø—Ç–æ—Ç–∏—á–µ—Å–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω. –ù–µ —Å—Ç–æ–∏—Ç –∑–∞–º–µ–Ω—è—Ç—å LINQ –Ω–∞ foreach, –∞ –∑–∞–º–µ–Ω–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –ø–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω—ã–π ‚Äî —Å—Ç–æ–∏—Ç.
5. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
6. –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ—Ö —Ç–µ—Å—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –Ω–∞ ulearn –∏–ª–∏ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö.

1. –í —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–º–µ—Ç—å –≤—ã—á–∏—Å–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤–∏–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: –º–∞—Ç–æ–∂–∏–¥–∞–Ω–∏–µ –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã. –ü—Ä–∏ —ç—Ç–æ–º –≤—ã—á–∏—Å–ª—è—Ç—å –Ω—É–∂–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ ‚Äî –º—ã –æ–∂–∏–¥–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ O(n).

–í—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞	ExpectedValue
2+2*2 ->	6
1d20 ->	10.5
2d6+(-1d12/5) ->	5.7
(1d12+2d6)/2 ->	6.75
3/2.1+100d100-4d8+1d4 ->	5035.928571428572

2. –¢–µ–ø–µ—Ä—å –ø–æ–º–∏–º–æ –º–∞—Ç–æ–∂–∏–¥–∞–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –µ—â–µ —É–º–µ—Ç—å –≤—ã—á–∏—Å–ª—è—Ç—å –¥–∏—Å–ø–µ—Ä—Å–∏—é –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã. –ò –º—ã –≤—Å—ë –µ—â—ë –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –±—É–¥–µ—Ç O(n).
–í—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞	ExpectedValue	Variance
2+2*2 ->	6 ->	0
1d20 ->	10.5 ->	33.25
2d6+(-1d12/5) ->	5.7 ->	6.31
(1d12+2d6)/2 ->	6.75 ->	4.4375
3/2.1+100d100-4d8+1d4 ->	5035.928571428572 ->	83347.25

3. –¢–µ–ø–µ—Ä—å –ø–æ–º–∏–º–æ –º–∞—Ç–æ–∂–∏–¥–∞–Ω–∏—è –∏ –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–º–µ—Ç—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∏ —Ñ—É–Ω–∫—Ü–∏—é –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã (f).

–ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏ –∑–∞–¥–∞—á–∞ —Ä–∞—Å—Å—á—ë—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏ f –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è, –ø–æ—ç—Ç–æ–º—É –Ω–µ –±—É–¥–µ–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø—Ä–∏ –µ—ë —Ä–∞—Å—Å—á—ë—Ç–µ (–æ–¥–Ω–∞–∫–æ –æ—á–µ–≤–∏–¥–Ω–æ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏—Å—ã–ª–∞—Ç—å –Ω–µ —Å—Ç–æ–∏—Ç). –ù–æ –ø–æ–º–Ω–∏, —á—Ç–æ –≤–∞—à –∫–æ–¥ –≤—Å—ë –µ—â—ë –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å —Ä–∞—Å—Å—á–∏—ã–≤–∞—Ç—å –º–∞—Ç–æ–∂–∏–¥–∞–Ω–∏–µ –∏ –¥–∏—Å–ø–µ—Ä—Å–∏—é –∑–∞ O(n).
